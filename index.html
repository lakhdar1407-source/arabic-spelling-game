<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø¯Ù‘ Ø§Ù„Ø­Ø¨Ù„ - Arabic Spelling Tug of War</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        /* Fireworks */
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: firework 1.5s ease-out forwards;
        }
        
        @keyframes firework {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }
        
        .firework-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons as inline SVG components
        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );
        
        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );
        
        const Play = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );
        
        const Delete = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
                <line x1="18" y1="9" x2="12" y2="15"></line>
                <line x1="12" y1="9" x2="18" y2="15"></line>
            </svg>
        );
        
        const Check = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );
        
        const Maximize = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
        );
        
        const Minimize = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
            </svg>
        );
        
        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );
        
        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const ArabicSpellingGame = () => {
          const [mode, setMode] = useState('dashboard');
          const [rounds, setRounds] = useState([]);
          const [currentRound, setCurrentRound] = useState(0);
          const [player1Input, setPlayer1Input] = useState('');
          const [player2Input, setPlayer2Input] = useState('');
          const [ropePosition, setRopePosition] = useState(50);
          const [player1Score, setPlayer1Score] = useState(0);
          const [player2Score, setPlayer2Score] = useState(0);
          const [roundWinner, setRoundWinner] = useState(null);
          const [showFeedback, setShowFeedback] = useState(false);
          const [timeLeft, setTimeLeft] = useState(45);
          const [timerActive, setTimerActive] = useState(false);
          const [wrongAnswer, setWrongAnswer] = useState({ player1: false, player2: false });
          const [isFullscreen, setIsFullscreen] = useState(false);
          const [showFireworks, setShowFireworks] = useState(false);
          const [showRoundOptions, setShowRoundOptions] = useState(false);
          
          const [editingRound, setEditingRound] = useState(null);
          const [newWord, setNewWord] = useState('');
          const [newLetters, setNewLetters] = useState('');
          const [newPrompt, setNewPrompt] = useState('');

          // Load saved rounds from localStorage on mount
          useEffect(() => {
            const savedRounds = localStorage.getItem('arabicSpellingRounds');
            if (savedRounds) {
              try {
                setRounds(JSON.parse(savedRounds));
              } catch (e) {
                console.log('Error loading saved rounds:', e);
              }
            }
          }, []);

          // Save rounds to localStorage whenever they change
          useEffect(() => {
            if (rounds.length > 0) {
              localStorage.setItem('arabicSpellingRounds', JSON.stringify(rounds));
            }
          }, [rounds]);

          // Fullscreen toggle
          const toggleFullscreen = () => {
            if (!document.fullscreenElement) {
              document.documentElement.requestFullscreen();
              setIsFullscreen(true);
            } else {
              document.exitFullscreen();
              setIsFullscreen(false);
            }
          };

          // Listen for fullscreen changes
          useEffect(() => {
            const handleFullscreenChange = () => {
              setIsFullscreen(!!document.fullscreenElement);
            };
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);
          }, []);

          useEffect(() => {
            if (mode === 'playing' && timerActive && timeLeft > 0 && !roundWinner) {
              const timer = setTimeout(() => {
                setTimeLeft(prev => prev - 1);
              }, 1000);
              return () => clearTimeout(timer);
            } else if (timeLeft === 0 && !roundWinner) {
              setShowFeedback(true);
              setTimeout(() => {
                setShowFeedback(false);
                if (currentRound < rounds.length - 1) {
                  setCurrentRound(prev => prev + 1);
                  setPlayer1Input('');
                  setPlayer2Input('');
                  setTimeLeft(45);
                  setWrongAnswer({ player1: false, player2: false });
                } else {
                  setMode('gameOver');
                }
              }, 2000);
            }
          }, [mode, timerActive, timeLeft, roundWinner, currentRound, rounds.length]);

          const startGame = () => {
            if (rounds.length === 0) {
              alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ - Please add words first!');
              return;
            }
            setMode('playing');
            setCurrentRound(0);
            setRopePosition(50);
            setPlayer1Score(0);
            setPlayer2Score(0);
            setPlayer1Input('');
            setPlayer2Input('');
            setRoundWinner(null);
            setTimeLeft(45);
            setTimerActive(true);
            setWrongAnswer({ player1: false, player2: false });
            setShowRoundOptions(false);
            setShowFireworks(false);
          };

          const addRound = () => {
            if (!newWord.trim()) {
              alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© - Please enter a word');
              return;
            }
            
            const lettersArray = newLetters.trim().split('').filter(l => l.trim());
            if (lettersArray.length < 9 || lettersArray.length > 10) {
              alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ Ø¨ÙŠÙ† 9 Ùˆ 10 - Letters must be 9-10');
              return;
            }
            
            const newRoundObj = {
              id: Date.now(),
              word: newWord.trim(),
              letters: lettersArray,
              prompt: newPrompt.trim() || newWord.trim()
            };
            
            if (editingRound !== null) {
              setRounds(rounds.map(r => r.id === editingRound ? newRoundObj : r));
              setEditingRound(null);
            } else {
              setRounds([...rounds, newRoundObj]);
            }
            
            setNewWord('');
            setNewLetters('');
            setNewPrompt('');
          };

          const deleteRound = (id) => {
            setRounds(rounds.filter(r => r.id !== id));
          };

          const editRound = (round) => {
            setEditingRound(round.id);
            setNewWord(round.word);
            setNewLetters(round.letters.join(''));
            setNewPrompt(round.prompt);
          };

          const cancelEdit = () => {
            setEditingRound(null);
            setNewWord('');
            setNewLetters('');
            setNewPrompt('');
          };

          const saveWordList = () => {
            const dataStr = JSON.stringify(rounds, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'arabic-spelling-words.json';
            link.click();
            URL.revokeObjectURL(url);
          };

          const loadWordList = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            // Handle Excel files (.xlsx, .xls)
            if (fileExtension === 'xlsx' || fileExtension === 'xls') {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const data = new Uint8Array(e.target.result);
                  const workbook = XLSX.read(data, { type: 'array' });
                  const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                  const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                  
                  const loadedRounds = jsonData.map((row, index) => ({
                    id: Date.now() + index,
                    word: (row['Ø§Ù„ÙƒÙ„Ù…Ø©'] || row['Word'] || '').trim(),
                    letters: (row['Ø§Ù„Ø­Ø±ÙˆÙ'] || row['Letters'] || '').trim().split('').filter(l => l.trim()),
                    prompt: (row['Ø§Ù„Ø³Ø¤Ø§Ù„'] || row['Prompt'] || row['Ø§Ù„ÙƒÙ„Ù…Ø©'] || row['Word'] || '').trim()
                  })).filter(round => round.word && round.letters.length >= 9 && round.letters.length <= 10);
                  
                  if (loadedRounds.length > 0) {
                    setRounds(loadedRounds);
                    alert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${loadedRounds.length} ÙƒÙ„Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­! - Loaded ${loadedRounds.length} words successfully!`);
                  } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù - No valid words found in file');
                  }
                } catch (error) {
                  alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel - Error reading Excel file: ' + error.message);
                }
              };
              reader.readAsArrayBuffer(file);
            }
            // Handle text files (.txt)
            else if (fileExtension === 'txt') {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const lines = e.target.result.split('\n').filter(line => line.trim());
                  const loadedRounds = [];
                  
                  for (let i = 0; i < lines.length; i++) {
                    const parts = lines[i].split('|').map(p => p.trim());
                    if (parts.length >= 2) {
                      const word = parts[0];
                      const letters = parts[1].split('').filter(l => l.trim());
                      const prompt = parts[2] || word;
                      
                      if (word && letters.length >= 9 && letters.length <= 10) {
                        loadedRounds.push({
                          id: Date.now() + i,
                          word: word,
                          letters: letters,
                          prompt: prompt
                        });
                      }
                    }
                  }
                  
                  if (loadedRounds.length > 0) {
                    setRounds(loadedRounds);
                    alert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${loadedRounds.length} ÙƒÙ„Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­! - Loaded ${loadedRounds.length} words successfully!`);
                  } else {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ØµØ§Ù„Ø­Ø© - No valid words found');
                  }
                } catch (error) {
                  alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù - Error reading file');
                }
              };
              reader.readAsText(file);
            }
            // Handle JSON files
            else if (fileExtension === 'json') {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const loadedRounds = JSON.parse(e.target.result);
                  setRounds(loadedRounds);
                  alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! - Word list loaded successfully!');
                } catch (error) {
                  alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù - Error loading file');
                }
              };
              reader.readAsText(file);
            } else {
              alert('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… - Unsupported file type. Use .xlsx, .txt, or .json');
            }
            
            // Reset input
            event.target.value = '';
          };

          const downloadTemplate = () => {
            const templateData = [
              { 'Ø§Ù„ÙƒÙ„Ù…Ø©': 'Ù…Ø¯Ø±Ø³Ø©', 'Ø§Ù„Ø­Ø±ÙˆÙ': 'Ù…Ø¯Ø±Ø³Ø©ØªØ´Ø²Ø¨', 'Ø§Ù„Ø³Ø¤Ø§Ù„': 'Ø£Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ___ ÙƒÙ„ ÙŠÙˆÙ…' },
              { 'Ø§Ù„ÙƒÙ„Ù…Ø©': 'ÙƒØªØ§Ø¨', 'Ø§Ù„Ø­Ø±ÙˆÙ': 'ÙƒØªØ§Ø¨Ø©Ù…Ø±Ø³Ù„', 'Ø§Ù„Ø³Ø¤Ø§Ù„': 'Ù†Ù‚Ø±Ø£ ___' },
              { 'Ø§Ù„ÙƒÙ„Ù…Ø©': 'Ù‚Ù„Ù…', 'Ø§Ù„Ø­Ø±ÙˆÙ': 'Ù‚Ù„Ù…ÙƒÙ†Ø¨Ø±Ø³Øª', 'Ø§Ù„Ø³Ø¤Ø§Ù„': 'Ù†ÙƒØªØ¨ Ø¨Ù€ ___' }
            ];
            
            const ws = XLSX.utils.json_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Word List');
            
            // Set column widths
            ws['!cols'] = [
              { wch: 15 },
              { wch: 20 },
              { wch: 30 }
            ];
            
            XLSX.writeFile(wb, 'arabic-spelling-template.xlsx');
          };

          const clearAllRounds = () => {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆÙ„Ø§ØªØŸ - Are you sure you want to delete all rounds?')) {
              setRounds([]);
              localStorage.removeItem('arabicSpellingRounds');
            }
          };

          const continueToNextRound = () => {
            setCurrentRound(0);
            setPlayer1Input('');
            setPlayer2Input('');
            setRoundWinner(null);
            setTimeLeft(45);
            setTimerActive(true);
            setWrongAnswer({ player1: false, player2: false });
            setShowRoundOptions(false);
          };

          const endGameEarly = () => {
            setMode('gameOver');
            setShowFireworks(true);
            setTimeout(() => setShowFireworks(false), 5000);
          };

          const Fireworks = () => {
            const [particles, setParticles] = React.useState([]);

            React.useEffect(() => {
              if (!showFireworks) return;

              const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff1493'];
              const newParticles = [];

              const createFirework = (x, y) => {
                for (let i = 0; i < 30; i++) {
                  const angle = (Math.PI * 2 * i) / 30;
                  const velocity = 100 + Math.random() * 100;
                  newParticles.push({
                    id: Math.random(),
                    x: x,
                    y: y,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    velocityX: Math.cos(angle) * velocity,
                    velocityY: Math.sin(angle) * velocity
                  });
                }
              };

              // Create multiple fireworks
              for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                  const x = Math.random() * window.innerWidth;
                  const y = Math.random() * (window.innerHeight * 0.6);
                  createFirework(x, y);
                }, i * 300);
              }

              setParticles(newParticles);

              const timer = setTimeout(() => {
                setParticles([]);
              }, 5000);

              return () => clearTimeout(timer);
            }, []);

            return (
              <div className="firework-container">
                {particles.map(particle => (
                  <div
                    key={particle.id}
                    className="firework"
                    style={{
                      left: particle.x + 'px',
                      top: particle.y + 'px',
                      backgroundColor: particle.color,
                      '--x': particle.velocityX + 'px',
                      '--y': particle.velocityY + 'px'
                    }}
                  />
                ))}
              </div>
            );
          };

          const handleLetterClick = (letter, player) => {
            if (roundWinner) return;
            
            if (player === 1) {
              setPlayer1Input(prev => prev + letter);
            } else {
              setPlayer2Input(prev => prev + letter);
            }
          };

          const handleBackspace = (player) => {
            if (roundWinner) return;
            
            if (player === 1) {
              setPlayer1Input(prev => prev.slice(0, -1));
            } else {
              setPlayer2Input(prev => prev.slice(0, -1));
            }
          };

          const handleSubmit = (player) => {
            if (roundWinner) return;
            
            const round = rounds[currentRound];
            const input = player === 1 ? player1Input : player2Input;
            const correct = input.trim() === round.word;
            
            if (correct) {
              try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 1.5;
                const sampleRate = audioContext.sampleRate;
                const buffer = audioContext.createBuffer(2, duration * sampleRate, sampleRate);
                
                for (let channel = 0; channel < 2; channel++) {
                  const data = buffer.getChannelData(channel);
                  for (let i = 0; i < buffer.length; i++) {
                    const envelope = Math.max(0, 1 - (i / buffer.length));
                    data[i] = (Math.random() * 2 - 1) * envelope * 0.3;
                  }
                }
                
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                const filter = audioContext.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = 1000;
                source.connect(filter);
                filter.connect(audioContext.destination);
                source.start();
              } catch (e) {
                console.log('Audio not available:', e);
              }
              
              setRoundWinner(player);
              setShowFeedback(true);
              setTimerActive(false);
              
              if (player === 1) {
                setPlayer1Score(prev => prev + 1);
                setRopePosition(prev => Math.max(0, prev - 15));
              } else {
                setPlayer2Score(prev => prev + 1);
                setRopePosition(prev => Math.min(100, prev + 15));
              }
              
              setTimeout(() => {
                setShowFeedback(false);
                if (currentRound < rounds.length - 1) {
                  setCurrentRound(prev => prev + 1);
                  setPlayer1Input('');
                  setPlayer2Input('');
                  setRoundWinner(null);
                  setTimeLeft(45);
                  setTimerActive(true);
                  setWrongAnswer({ player1: false, player2: false });
                } else {
                  setShowRoundOptions(true);
                }
              }, 2000);
            } else {
              try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
              } catch (e) {
                console.log('Audio not available:', e);
              }
              
              setWrongAnswer(prev => ({ ...prev, [`player${player}`]: true }));
              
              if (player === 1) {
                setPlayer1Input('');
              } else {
                setPlayer2Input('');
              }
              
              setTimeout(() => {
                setWrongAnswer(prev => ({ ...prev, [`player${player}`]: false }));
              }, 500);
            }
          };

          const Keyboard = ({ player, input, letters }) => {
            const bgColor = player === 1 ? 'bg-blue-500' : 'bg-red-500';
            const hoverColor = player === 1 ? 'hover:bg-blue-600' : 'hover:bg-red-600';
            const isWrong = player === 1 ? wrongAnswer.player1 : wrongAnswer.player2;
            
            return (
              <div className="flex flex-col gap-3">
                <div 
                  className={`bg-white rounded-lg p-3 min-h-[60px] flex items-center justify-center border-4 transition-all ${
                    isWrong ? 'border-red-600 bg-red-100 animate-pulse' : ''
                  }`}
                  style={{ borderColor: isWrong ? '#dc2626' : (player === 1 ? '#3b82f6' : '#ef4444') }}
                >
                  <div className="text-3xl font-bold" dir="rtl">{input || '___'}</div>
                </div>
                
                <div className="grid grid-cols-3 gap-2">
                  {letters.map((letter, idx) => (
                    <button
                      key={`${letter}-${idx}`}
                      onClick={() => handleLetterClick(letter, player)}
                      disabled={roundWinner !== null}
                      className={`${bgColor} ${hoverColor} text-white text-2xl font-bold py-4 px-6 rounded-lg disabled:opacity-50 transition-all transform active:scale-95`}
                    >
                      {letter}
                    </button>
                  ))}
                </div>
                
                <div className="flex gap-2">
                  <button
                    onClick={() => handleBackspace(player)}
                    disabled={roundWinner !== null}
                    className={`${bgColor} ${hoverColor} text-white py-3 px-4 rounded-lg flex-1 disabled:opacity-50 flex items-center justify-center gap-2`}
                  >
                    <Delete size={20} />
                    <span>Ù…Ø³Ø­</span>
                  </button>
                  <button
                    onClick={() => handleSubmit(player)}
                    disabled={roundWinner !== null}
                    className={`${bgColor} ${hoverColor} text-white py-3 px-4 rounded-lg flex-1 disabled:opacity-50 flex items-center justify-center gap-2`}
                  >
                    <Check size={20} />
                    <span>âœ“</span>
                  </button>
                </div>
              </div>
            );
          };

          if (mode === 'dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-100 to-blue-100 p-6">
                <div className="max-w-6xl mx-auto">
                  <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                    <div className="flex justify-between items-center mb-4">
                      <h1 className="text-4xl font-bold text-center flex-1" dir="rtl">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
                      <button
                        onClick={toggleFullscreen}
                        className="bg-gray-200 hover:bg-gray-300 p-3 rounded-lg transition"
                        title={isFullscreen ? "Exit Fullscreen" : "Enter Fullscreen"}
                      >
                        {isFullscreen ? <Minimize size={24} /> : <Maximize size={24} />}
                      </button>
                    </div>
                    <h2 className="text-2xl text-gray-600 text-center mb-6">Teacher Dashboard</h2>
                    
                    {/* Save/Load/Clear Buttons */}
                    <div className="flex gap-3 mb-6 flex-wrap justify-center">
                      <button
                        onClick={downloadTemplate}
                        className="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition"
                      >
                        <Download size={20} />
                        ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ - Download Template
                      </button>
                      
                      <button
                        onClick={saveWordList}
                        disabled={rounds.length === 0}
                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition disabled:opacity-50"
                      >
                        <Download size={20} />
                        Ø­ÙØ¸ JSON - Save JSON
                      </button>
                      
                      <label className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition cursor-pointer">
                        <Upload size={20} />
                        ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù - Upload File
                        <input
                          type="file"
                          accept=".xlsx,.xls,.txt,.json"
                          onChange={loadWordList}
                          className="hidden"
                        />
                      </label>
                      
                      <button
                        onClick={clearAllRounds}
                        disabled={rounds.length === 0}
                        className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition disabled:opacity-50"
                      >
                        <Trash2 size={20} />
                        Ø­Ø°Ù Ø§Ù„ÙƒÙ„ - Clear All
                      </button>
                    </div>
                    
                    {/* Instructions */}
                    <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-6">
                      <h4 className="font-bold mb-2">ğŸ“ ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ - How to use the template:</h4>
                      <ol className="list-decimal list-inside space-y-1 text-sm">
                        <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨" Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù Excel - Click "Download Template" to get Excel file</li>
                        <li>Ø§Ù…Ù„Ø£ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ù„Ø§Ø«Ø©: Ø§Ù„ÙƒÙ„Ù…Ø©ØŒ Ø§Ù„Ø­Ø±ÙˆÙ (9-10)ØŒ Ø§Ù„Ø³Ø¤Ø§Ù„ - Fill 3 columns: Word, Letters (9-10), Prompt</li>
                        <li>Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ø¶ØºØ· "ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù" - Save file and click "Upload File"</li>
                        <li>Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù„Ù .txt Ø¨ØµÙŠØºØ©: ÙƒÙ„Ù…Ø©|Ø­Ø±ÙˆÙ|Ø³Ø¤Ø§Ù„ - Or use .txt format: word|letters|prompt</li>
                      </ol>
                    </div>
                    
                    <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6">
                      <h3 className="text-xl font-bold mb-4">
                        {editingRound ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø© - Edit Round' : 'Ø¥Ø¶Ø§ÙØ© Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© - Add New Round'}
                      </h3>
                      
                      <div className="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                          <label className="block text-sm font-bold mb-2" dir="rtl">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© - Target Word</label>
                          <input
                            type="text"
                            value={newWord}
                            onChange={(e) => setNewWord(e.target.value)}
                            placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯Ø±Ø³Ø©"
                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-xl text-right"
                            dir="rtl"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-bold mb-2" dir="rtl">Ø§Ù„Ø­Ø±ÙˆÙ (9-10 Ø­Ø±ÙˆÙ) - Letters (9-10)</label>
                          <input
                            type="text"
                            value={newLetters}
                            onChange={(e) => setNewLetters(e.target.value)}
                            placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯Ø±Ø³Ø©ØªØ´Ø²Ø¨"
                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-xl text-right"
                            dir="rtl"
                          />
                          <p className="text-xs text-gray-600 mt-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ: {newLetters.trim().split('').filter(l => l.trim()).length}</p>
                        </div>
                      </div>
                      
                      <div className="mb-4">
                        <label className="block text-sm font-bold mb-2" dir="rtl">Ø§Ù„Ø³Ø¤Ø§Ù„ / Ø§Ù„ÙˆØµÙ - Prompt / Description</label>
                        <input
                          type="text"
                          value={newPrompt}
                          onChange={(e) => setNewPrompt(e.target.value)}
                          placeholder="Ù…Ø«Ø§Ù„: Ø£Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ___ ÙƒÙ„ ÙŠÙˆÙ…"
                          className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-xl text-right"
                          dir="rtl"
                        />
                      </div>
                      
                      <div className="flex gap-3">
                        <button
                          onClick={addRound}
                          className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg flex items-center gap-2 transition"
                        >
                          {editingRound ? <Edit2 size={20} /> : <Plus size={20} />}
                          {editingRound ? 'ØªØ­Ø¯ÙŠØ« - Update' : 'Ø¥Ø¶Ø§ÙØ© - Add'}
                        </button>
                        
                        {editingRound && (
                          <button
                            onClick={cancelEdit}
                            className="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition"
                          >
                            Ø¥Ù„ØºØ§Ø¡ - Cancel
                          </button>
                        )}
                      </div>
                    </div>
                    
                    <div>
                      <h3 className="text-xl font-bold mb-4">Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© - Added Rounds ({rounds.length})</h3>
                      
                      {rounds.length === 0 ? (
                        <div className="text-center py-8 text-gray-500">
                          <p className="text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯ - No rounds added yet</p>
                          <p className="text-sm">Ø£Ø¶Ù Ø¬ÙˆÙ„Ø§Øª Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© - Add rounds to start the game</p>
                        </div>
                      ) : (
                        <div className="space-y-3">
                          {rounds.map((round, idx) => (
                            <div key={round.id} className="bg-gray-50 rounded-lg p-4 flex items-center justify-between">
                              <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                  <span className="bg-blue-500 text-white font-bold px-3 py-1 rounded">#{idx + 1}</span>
                                  <span className="text-2xl font-bold" dir="rtl">{round.word}</span>
                                </div>
                                <div className="text-sm text-gray-600 mb-1" dir="rtl">
                                  <strong>Ø§Ù„Ø­Ø±ÙˆÙ:</strong> {round.letters.join(' ')}
                                </div>
                                <div className="text-sm text-gray-600" dir="rtl">
                                  <strong>Ø§Ù„Ø³Ø¤Ø§Ù„:</strong> {round.prompt}
                                </div>
                              </div>
                              
                              <div className="flex gap-2">
                                <button
                                  onClick={() => editRound(round)}
                                  className="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg transition"
                                >
                                  <Edit2 size={18} />
                                </button>
                                <button
                                  onClick={() => deleteRound(round.id)}
                                  className="bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg transition"
                                >
                                  <Trash2 size={18} />
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                    
                    <div className="mt-8 text-center">
                      <button
                        onClick={startGame}
                        disabled={rounds.length === 0}
                        className="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-12 rounded-xl text-2xl transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 mx-auto"
                      >
                        <Play size={28} />
                        Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© - Start Game
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (mode === 'gameOver') {
            const winner = player1Score > player2Score ? 1 : player2Score > player1Score ? 2 : 0;
            return (
              <>
                {showFireworks && <Fireworks />}
                <div className="min-h-screen bg-gradient-to-br from-purple-400 to-pink-500 flex items-center justify-center p-4">
                  <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center relative">
                    <button
                      onClick={toggleFullscreen}
                      className="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 p-2 rounded-lg transition"
                    >
                      {isFullscreen ? <Minimize size={20} /> : <Maximize size={20} />}
                    </button>
                    
                    <h1 className="text-4xl font-bold mb-4">
                      {winner === 0 ? 'ØªØ¹Ø§Ø¯Ù„! - Tie! ğŸŠ' : `Ø§Ù„ÙØ§Ø¦Ø² - Winner: Player ${winner}! ğŸ‰`}
                    </h1>
                    <div className="text-2xl mb-8">
                      <div className="text-blue-600 font-bold mb-2">Player 1: {player1Score}</div>
                      <div className="text-red-600 font-bold">Player 2: {player2Score}</div>
                    </div>
                    <div className="flex gap-3 justify-center">
                      <button
                        onClick={startGame}
                        className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition"
                      >
                        Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ - Play Again
                      </button>
                      <button
                        onClick={() => setMode('dashboard')}
                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition"
                      >
                        Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… - Dashboard
                      </button>
                    </div>
                  </div>
                </div>
              </>
            );
          }

          const round = rounds[currentRound];
          
          return (
            <div className="min-h-screen bg-gradient-to-br from-amber-200 to-orange-300 p-4">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-xl shadow-lg p-4 mb-4">
                  <div className="flex justify-between items-center mb-2">
                    <div className="text-blue-600 font-bold text-xl">Player 1: {player1Score}</div>
                    <div className="text-center flex-1">
                      <div className="text-sm text-gray-600">Word {currentRound + 1}/{rounds.length}</div>
                      <div className="text-2xl font-bold" dir="rtl">{round.prompt}</div>
                      <div className={`mt-2 text-3xl font-bold ${timeLeft <= 10 ? 'text-red-600 animate-pulse' : 'text-gray-700'}`}>
                        â±ï¸ {timeLeft}s
                      </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <div className="text-red-600 font-bold text-xl">Player 2: {player2Score}</div>
                      <button
                        onClick={toggleFullscreen}
                        className="bg-gray-200 hover:bg-gray-300 p-2 rounded-lg transition"
                      >
                        {isFullscreen ? <Minimize size={20} /> : <Maximize size={20} />}
                      </button>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-6 mb-4">
                  <div className="relative h-24 flex items-center">
                    <div 
                      className="absolute transition-all duration-500 ease-out"
                      style={{ left: `${ropePosition * 0.7}%`, transform: 'translateX(-50%)' }}
                    >
                      <div className="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-2xl border-4 border-blue-700">
                        1
                      </div>
                    </div>
                    
                    <div className="w-full h-4 bg-gradient-to-r from-blue-400 via-yellow-600 to-red-400 rounded-full relative">
                      <div 
                        className="absolute top-1/2 w-6 h-6 bg-yellow-300 rounded-full border-4 border-yellow-600 transition-all duration-500"
                        style={{ left: `${ropePosition}%`, transform: 'translate(-50%, -50%)' }}
                      />
                    </div>
                    
                    <div 
                      className="absolute transition-all duration-500 ease-out"
                      style={{ right: `${(100 - ropePosition) * 0.7}%`, transform: 'translateX(50%)' }}
                    >
                      <div className="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white font-bold text-2xl border-4 border-red-700">
                        2
                      </div>
                    </div>
                  </div>
                </div>

                {showFeedback && (
                  <div className="text-center mb-4">
                    <div className={`inline-block px-8 py-4 rounded-lg text-2xl font-bold ${
                      roundWinner === 1 ? 'bg-blue-500' : roundWinner === 2 ? 'bg-red-500' : 'bg-gray-500'
                    } text-white animate-bounce`}>
                      {roundWinner ? `âœ“ ØµØ­ÙŠØ­! Player ${roundWinner} wins! ğŸ‰` : 'â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª - Time\'s Up!'}
                    </div>
                  </div>
                )}

                {/* Round Options Modal */}
                {showRoundOptions && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center mx-4">
                      <h2 className="text-3xl font-bold mb-6">ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª! - All Words Complete!</h2>
                      <p className="text-gray-600 mb-8">Ù‡Ù„ ØªØ±ÙŠØ¯ Ù„Ø¹Ø¨ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£Ù… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ<br/>Play a new round or end the game?</p>
                      <div className="flex flex-col gap-4">
                        <button
                          onClick={continueToNextRound}
                          className="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-xl text-xl transition transform hover:scale-105"
                        >
                          ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© - New Round
                        </button>
                        <button
                          onClick={endGameEarly}
                          className="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-8 rounded-xl text-xl transition transform hover:scale-105"
                        >
                          ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© - End Game
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-blue-50 rounded-xl shadow-lg p-4">
                    <h3 className="text-2xl font-bold text-blue-600 mb-3 text-center">Player 1</h3>
                    <Keyboard player={1} input={player1Input} letters={round.letters} />
                  </div>
                  
                  <div className="bg-red-50 rounded-xl shadow-lg p-4">
                    <h3 className="text-2xl font-bold text-red-600 mb-3 text-center">Player 2</h3>
                    <Keyboard player={2} input={player2Input} letters={round.letters} />
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ArabicSpellingGame />);
    </script>
</body>
</html>
